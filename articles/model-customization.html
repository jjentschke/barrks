<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model customization â€¢ barrks</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Model customization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">barrks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bso.html">The BSO model</a></li>
    <li><a class="dropdown-item" href="../articles/model-comparison.html">Example: Model comparison</a></li>
    <li><a class="dropdown-item" href="../articles/model-customization.html">Model customization</a></li>
    <li><a class="dropdown-item" href="../articles/stations.html">Station data</a></li>
    <li><a class="dropdown-item" href="../articles/storage.html">Use a storage</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jjentschke/barrks/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model customization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jjentschke/barrks/blob/HEAD/vignettes/model-customization.Rmd" class="external-link"><code>vignettes/model-customization.Rmd</code></a></small>
      <div class="d-none name"><code>model-customization.Rmd</code></div>
    </div>

    
    
<p><code>barrks</code> offers multiple ways of model customization. The
parameters of a model can be modified and individual submodels can be
combined to create a new model. Furthermore, it is possible to create
phenological events (such as onset, diapause and mortality) manually to
apply a model with observed or arbitrary data. This vignette illustrates
the corresponding procedures and compares the respective outputs with an
unmodified model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jjentschke.github.io/barrks/">barrks</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># function to unify the appearance of raster plots</span></span>
<span><span class="va">my_rst_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rst</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rst</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>       axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">TRUE</span>, nr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       cex.main <span class="op">=</span> <span class="fl">1.9</span>, plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/barrks_data.html">barrks_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate phenology without modification for comparison</span></span>
<span><span class="va">pheno_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenology.html">phenology</a></span><span class="op">(</span><span class="st">'phenips'</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="modify-and-combine-models">Modify and combine models<a class="anchor" aria-label="anchor" href="#modify-and-combine-models"></a>
</h2>
<p>To modify parameters of individual models the new values should be
passed to <code><a href="../reference/model.html">model()</a></code>. In this example PHENIPS is customized by
setting the daylength threshold for the diapause submodel to 14 hours
(default are 14.5 hours). The parameters available for customization are
found on the model customization manuals which are listed at the
<code><a href="../reference/model.html">model()</a></code> manual.</p>
<p>To combine individual submodels, <code><a href="../reference/model_combine.html">model_combine()</a></code> is
used. As parameters, the individual models are listed. To combine a
model with a specific submodel, pass a list with the keys
<code>model</code> and <code>submodels</code>. In the example PHENIPS is
combined with the diapause submodel of PHENIPS-Clim.</p>
<p>To compare the model outputs, the prevailing generations for all
calculated models are plotted on four different dates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># calculate phenology with a customized model</span></span>
<span><span class="va">model_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="st">'phenips'</span>, daylength_dia <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="co"># `daylength_dia` is 14.5 by default</span></span>
<span><span class="va">pheno_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenology.html">phenology</a></span><span class="op">(</span><span class="va">model_custom</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate phenology with a combined model</span></span>
<span><span class="va">model_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_combine.html">model_combine</a></span><span class="op">(</span><span class="st">'phenips'</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">'phenips-clim'</span>,</span>
<span>                                     submodels <span class="op">=</span> <span class="st">'diapause'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pheno_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenology.html">phenology</a></span><span class="op">(</span><span class="va">model_combined</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot generations</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2015-04-15'</span>, <span class="st">'2015-06-15'</span>, <span class="st">'2015-08-15'</span>, <span class="st">'2015-10-15'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_generations.html">get_generations_rst</a></span><span class="op">(</span><span class="va">pheno_std</span>, <span class="va">dates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">my_rst_plot</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_generations.html">get_generations_rst</a></span><span class="op">(</span><span class="va">pheno_custom</span>, <span class="va">dates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">my_rst_plot</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_generations.html">get_generations_rst</a></span><span class="op">(</span><span class="va">pheno_combined</span>, <span class="va">dates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">my_rst_plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/model-customization-gens-std-1.png" alt="Generations calculated by PHENIPS without modifications" width="100%"><p class="caption">
Generations calculated by PHENIPS without modifications
</p>
</div>
<div class="figure">
<img src="figures/model-customization-gens-custom-1.png" alt="Generations calculated by customized PHENIPS" width="100%"><p class="caption">
Generations calculated by customized PHENIPS
</p>
</div>
<div class="figure">
<img src="figures/model-customization-gens-combined-1.png" alt="Generations calculated by PHENIPS combined with diapause submodel of PHENIPS-Clim" width="100%"><p class="caption">
Generations calculated by PHENIPS combined with diapause submodel of
PHENIPS-Clim
</p>
</div>
</div>
<div class="section level2">
<h2 id="create-onset-diapause-or-mortality-events-manually">Create onset, diapause or mortality events manually<a class="anchor" aria-label="anchor" href="#create-onset-diapause-or-mortality-events-manually"></a>
</h2>
<p>To create phenological events manually, <code><a href="../reference/create_events.html">create_onset()</a></code>,
<code><a href="../reference/create_events.html">create_diapause()</a></code> and <code><a href="../reference/create_events.html">create_mortality()</a></code> are
used. These functions return multi-layer SpatRasters that can be used as
<code>.onset</code>, <code>.diapause</code> or <code>.mortality</code>
parameter for <code><a href="../reference/phenology.html">phenology()</a></code>. For instance, this practice can
be used to implement personal observations.</p>
<p>As an example, PHENIPS-Clim is applied on the station data delivered
with <code>barrks</code> and the onset is set to May 1st. The results
are plotted in a development diagram without sister broods to keep it
simple.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># calculate phenology without modification for comparison</span></span>
<span><span class="va">pheno_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenology.html">phenology</a></span><span class="op">(</span><span class="st">'phenips-clim'</span>, <span class="fu"><a href="../reference/barrks_data.html">barrks_data</a></span><span class="op">(</span><span class="st">'stations'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate phenology with a manually created onset</span></span>
<span><span class="va">onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_events.html">create_onset</a></span><span class="op">(</span><span class="fu"><a href="../reference/barrks_data.html">barrks_data</a></span><span class="op">(</span><span class="st">'stations'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Freiburg <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">yday</a></span><span class="op">(</span><span class="st">'2011-05-01'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pheno_manual</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenology.html">phenology</a></span><span class="op">(</span><span class="st">'phenips-clim'</span>, <span class="fu"><a href="../reference/barrks_data.html">barrks_data</a></span><span class="op">(</span><span class="st">'stations'</span><span class="op">)</span>, .onset <span class="op">=</span> <span class="va">onset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot for comparison</span></span>
<span><span class="fu"><a href="../reference/plot_development_diagram.html">plot_development_diagram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>default <span class="op">=</span> <span class="va">pheno_std</span>, manual <span class="op">=</span> <span class="va">pheno_manual</span><span class="op">)</span>,</span>
<span>                         xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2011-03-01'</span>, <span class="st">'2011-12-31'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         .generations <span class="op">=</span> <span class="fu"><a href="../reference/properties.html">prop_filial_generations</a></span><span class="op">(</span><span class="va">pheno_std</span><span class="op">)</span>,</span>
<span>                         .lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         .lwd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                         .legend_lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         .group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/model-customization-events-1.png" alt="Development diagram of PHENIPS-Clim with and without a manually created onset" width="100%"><p class="caption">
Development diagram of PHENIPS-Clim with and without a manually created
onset
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakob Jentschke, FVA BW, Abt. Waldschutz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
